# オブジェクト

- オブジェクト指向プログラミングのおかげでスッキリした設計で保守・再利用がしやすいコードが書けるようになった
- オブジェクトはコードとデータをひとまとまりにしたもの
- アプリケーションの一部分を部品化して再利用可能なものにする

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [用語](#%E7%94%A8%E8%AA%9E)
- [作成](#%E4%BD%9C%E6%88%90)
- [プロパティ・メソッドへのアクセス](#%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%83%BB%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9)
- [クラスの宣言](#%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%A3%E8%A8%80)
- [トレイト](#%E3%83%88%E3%83%AC%E3%82%A4%E3%83%88)
- [抽象メソッド](#%E6%8A%BD%E8%B1%A1%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89)
- [コンストラクタ](#%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF)
- [デストラクタ](#%E3%83%87%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF)
- [内部検査](#%E5%86%85%E9%83%A8%E6%A4%9C%E6%9F%BB)
- [シリアライズ](#%E3%82%B7%E3%83%AA%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%BA)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## 用語

PHPで使う用語

| 用語             | 説明                                                                 |
|------------------|----------------------------------------------------------------------|
| オブジェクト     | クラスを形にしたもの                                                 |
| プロパティ       | オブジェクトに関連づけられたデータ                                   |
| メソッド         | オブジェクトに関連づけられた関数                                     |
| カプセル化       | データ・オブジェクトの内容を隠蔽すること                             |
| インターフェイス | クラスの振る舞いを定義する                                           |
| 継承             | 新しいプロパティやメソッドを追加したり変更したりできるようにする手法 |
| スーパークラス   | 親クラス・基底クラスのこと                                           |
| サブクラス       | 子クラス・派生クラスのこと                                           |

## 作成

オブジェクトの生成

```php
$obj = new Hoge;
$obj = new Hoge();
```

変数から生成する

```php
$c = "Object";
$obj = new $c; // $obj = new Object;と同義
```

## プロパティ・メソッドへのアクセス

プロパティへのアクセス

```php
$obj->property;
```

メソッドへのアクセス

```php
$obj->fn();
```

スタティックメソッド

```php
HTML::p("Hello, world");
```

オブジェクトをコピーするには`clone()`演算子を使用する

```php
$a = new Object();
$b = clone $a;
```

## クラスの宣言

```php
class Class1
{
}
```

継承

```php
class Class1 extends Class2
{
}
```

インターフェイスの実装

```php
class Class1 implements Interface1
{
}
```

メソッドの宣言に`final`キーワードを使うとサブクラスでオーバーライドできなくなる

```php
class C1
{
  final function f()
  {
    echo "c1";
  }
}

class C2 extends C1
{
  function f() // Method 'C2::f()' cannot override final method 'C1::f()'.intelephense(1039)
  {
    echo "c2";
  }
}
```

アクセス修飾子

- public : 別のオブジェクトからアクセス可能
- private : 同じクラスのメソッドからのみアクセス可能
- protected : 同じクラス or 継承したクラスのメソッドのみアクセス可能

## トレイト

- コードを再利用するための仕組み
- 共通の先祖を持たないクラス同士でも機能を共有できる
- `use`キーワードを使用する

    ```php
    trait T1
    {
      public function t() { ... }
    }

    class C1
    {
      use T1;
    }

    $c = new C1;
    $c->t();
    ```

- トレイトで定義されたメソッドは自分で定義されたように使える
- メソッド名が衝突する場合は`insteadof`キーワードを使う

    ```php
    trait T1
    {
      public function f()
      {
        echo "A\n";
      }
    }

    trait T2
    {
      public function f()
      {
        echo "B\n";
      }
    }

    class C
    {
      use T1, T2 {
        T2::f insteadOf T1;
      }
    }

    $c = new C;
    $c->f(); // B
    ```

## 抽象メソッド

- そのクラスではメソッドの宣言のみで実装はせず、サブクラス側に実装させる仕組み
- `abstract`キーワードを使う
- 抽象クラスは作成できない
- `trait`でも使用できる
- 実装するときはメソッドシグネチャをマッチさせないといけない

## コンストラクタ

- 初期化された時に呼び出される関数
- `__construct()`関数を実装する

## デストラクタ

- オブジェクトが破棄される時に呼び出される関数
- PHPではスクリプトが終了した時に自動的にリソースの後始末を行うため、あまり使い道はない
- `__destruct()`関数を実装する

## 内部検査

- オブジェクトの性質(クラス名、親クラスが存在する場合クラス名、プロパティ、メソッド）を調べる機能
- 汎用的なデバッガ、シリアライザ、プロファイラなど作れる
- `class_exists()` : クラスが存在するかどうか
- `get_declared_classes()` : 定義されているクラスを配列で返す

## シリアライズ

- オブジェクトをバイトストリームに変換しファイルに保存できるようにすること
- 永続的なデータを扱う際に便利

